- id: Demande des temperatures
  alias: Demande des temperatures
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /temperatures
  action:
  - service: notify.teleha
    data:
      message: Voici les temperatures de la maison,  il fait {{ states('sensor.salon_temperature')
        }} degrés dans le salon, {{ states('sensor.tempchambre_temperature') }} degrés
        dans le chambre, {{ states('sensor.tempetage_temperature')}} degrés à l etage,
        {{ states('sensor.tempsdb_temperature')}} degrés dans la salle de bain et
        {{ states('sensor.tempext_temperature')}} degrés à l'exterieur.
- id: Annonce Matin Telegram
  alias: 'Annonce Matin Telegram '
  trigger:
  - entity_id: sensor.salon_motion
    from: '0'
    platform: state
    to: '1'
  condition:
  - after: 05:00
    before: '10:00'
    condition: time
  - condition: state
    entity_id: input_boolean.bonjour
    state: 'on'
  action:
  - data:
      message: Arnaud, La température exterieure est de {{ states.sensor.dark_sky_temperature.state
        | round }} degrés. {%- if as_timestamp(states.calendar.dalliesagmailcom.attributes.start_time)
        - as_timestamp(now().strftime("%Y-%m-%d %H:%M:%S")) < 86400 -%} .  Noubliez
        pas vous avez un rendez vous aujourdhui.  {{ states.calendar.dalliesagmailcom.attributes.message
        }}.{%- endif %} {%- if (states.calendar.contacts.state == 'on') -%} Noubliez
        pas vous avez un anniversaire a souhaiter, celui de {{ states.calendar.contacts.attributes.message
        }} {%- endif %}
    service: notify.teleha
  - data: {}
    entity_id: input_boolean.bonjour
    service: input_boolean.turn_off
- id: Demande du mode Surf
  alias: Demande du mode Surf
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /surf
  action:
  - service: notify.teleha
    data:
      message: 'Voici les conditions de surf à jour :'
      data:
        photo:
        - file: /config/www/surf/surf.png
- id: Demande ajout ToDo
  alias: Demande ajout ToDo
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /todo
  action:
  - service: notify.teleha
    data_template:
      message: 'Message contenu : {{ trigger.event.data["args"] }}'
  - service: shell_command.todoadd
    data_template:
      text: '{{ trigger.event.data["args"] }}'
- id: Demande suppr ToDo
  alias: Demande suppr ToDo
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /tododel
  action:
  - service: notify.teleha
    data_template:
      message: 'Message contenu : {{ trigger.event.data["args"] }}'
  - service: shell_command.tododel
    data_template:
      text: '{{ trigger.event.data["args"] }}'
- id: Clean ToDo
  alias: Clean ToDo
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /todoclear
  action:
  - service: shell_command.todoclear
- id: SqueezeBox PI On
  alias: SqueezeBox PI On
  trigger:
  - platform: state
    entity_id: media_player.pine64
    to: paused
  action:
    service: shell_command.squeezeon
- id: SqueezeBox PI On
  alias: SqueezeBox PI On
  trigger:
  - platform: state
    entity_id: media_player.pine64
    to: playing
  action:
    service: shell_command.squeezeoff
- id: Temperature choix
  alias: Temperature choix
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /degres
  action:
  - service: notify.teleha
    data:
      message: Quelle temperature voulez vous ?
      data:
        keyboard:
        - /Chambre
        - /Salon
        - /Etage
        - /Sdb
- id: Videos surf
  alias: Videos surf
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /webcam
  action:
  - service: notify.teleha
    data:
      message: Quelle Vidéos voulez vous ?
      data:
        keyboard:
        - /PlageNord1
        - /PlageNord2
        - /PlageCentrale1
        - /PlageCentrale2
- id: Plage Centrale 1
  alias: Plage Centrale 1
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /PlageCentrale1
  action:
  - service: telegram_bot.send_video
    data:
      caption: Voici la webcam Centrale numero 1
      file: /config/www/surf/videos/webcamsurf_centrale.mp4
- id: Plage Centrale 2
  alias: Plage Centrale 2
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /PlageCentrale2
  action:
  - service: telegram_bot.send_video
    data:
      caption: Voici la webcam Centrale numero 2
      file: /config/www/surf/videos/webcamsurf.mp4
- id: Plage Nord 1
  alias: Plage Nord 1
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /PlageNord1
  action:
  - service: telegram_bot.send_video
    data:
      caption: Voici la webcam Nord numero 1
      file: /config/www/surf/videos/webcamsurf_nord.mp4
- id: Plage Nord 2
  alias: Plage Nord 2
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /PlageNord2
  action:
  - service: telegram_bot.send_video
    data:
      caption: Voici la webcam Nord numero 2
      file: /config/www/surf/videos/webcamsurf_nord2.mp4
- id: Temperature Chambre
  alias: Temperature Chambre
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /Chambre
  action:
  - service: notify.teleha
    data:
      message: Il fait {{ states('sensor.tempchambre_temperature') }} degrés dans
        la chambre.
- id: Temperature Salon
  alias: Temperature Salon
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /Salon
  action:
  - service: notify.teleha
    data:
      message: Il fait {{ states('sensor.salon_temperature') }} degrés dans le salon.
- id: Temperature Etage
  alias: Temperature Etage
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /Etage
  action:
  - service: notify.teleha
    data:
      message: Il fait {{ states('sensor.tempetage_temperature')}} degrés à l'etage.
- id: Temperature Salle de bain
  alias: Temperature Salle de bain
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: /Sdb
  action:
  - service: notify.teleha
    data:
      message: Il fait {{ states('sensor.tempsdb_temperature')}} degrés dans la salle
        de bain.
- id: Surf Alert 13h
  alias: Surf Alert 13h
  trigger:
  - platform: state
    entity_id: sensor.surf13h
    from: mauvais surf, session médiocre
    to: bon surf, session sympa
  condition:
  - condition: time
    after: 09:00
    before: '18:00'
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.mpd
      volume_level: 0.72
  - service: tts.google_say
    entity_id: media_player.mpd
    data_template:
      message: Surf ALERTE !!!! les conditions ont changées pour ce debut d'après
        midi
      cache: false
  - service: notify.teleha
    data:
      title: surfcast
      message: Surf Alert
      data:
        photo:
        - file: /home/gano/.homeassistant/www/surf/surf.png
- id: Alerte SSL
  alias: Alerte SSL
  trigger:
  - platform: state
    entity_id: sensor.ssl_certificate_expiry
    from: '11'
    to: '10'
  action:
  - service: notify.teleha
    data:
      title: Alerte ssl
      message: Le certificat SSL est a renouveller dans 10 jours
- id: Update HA
  alias: Update HA
  trigger:
  - platform: state
    entity_id: updater.updater
  action:
  - service: notify.teleha
    data:
      message: Mise à jour disponible de Home Assistant.
- id: Surf Alert 17h
  alias: Surf Alert 17h
  trigger:
  - platform: state
    entity_id: sensor.surf17h
    from: mauvais surf, session médiocre
    to: bon surf, session sympa
  condition:
  - condition: time
    after: 09:00
    before: '20:00'
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.mpd
      volume_level: 0.72
  - service: tts.google_say
    entity_id: media_player.mpd
    data_template:
      message: Surf ALERTE !!!! les conditions ont changées pour la fin d'après midi
      cache: false
  - service: notify.teleha
    data:
      title: surfcast
      message: Surf Alert
      data:
        photo:
        - file: /home/gano/.homeassistant/www/surf/surf.png
- id: Retour maison
  alias: Retour maison
  trigger:
  - from: not_home
    platform: state
    to: home
    entity_id: person.arnaud
  condition:
  - after: '16:00'
    condition: time
    before: 08:30
  action:
  - data_template:
      entity_id: media_player.entree
      volume_level: 0.4
    service: media_player.volume_set
  - data_template:
      cache: false
      message: '{{ [''Heureux de vous voir Arnaud'',''Bon retour à la maison Arnaud'',''Salut
        Arnaud''] | random }},  {%- if states.sensor.salon_temperature.state | int
        < 17 -%} pour information il fait un peu froid dans le salon {%- endif %}'
    entity_id: media_player.entree
    service: tts.google_say
  mode: single
- id: Set alarmtime_hour
  alias: Set alarmtime_hour
  trigger:
  - platform: mqtt
    topic: setHour
  action:
  - service: input_number.set_value
    data_template:
      entity_id: input_number.alarmhour
      value: '{{ trigger.payload}}'
  - service: notify.pushgano
    data:
      message: Reveil positionne
- id: Set alarmtime_minutes
  alias: Set alarmtime_minutes
  trigger:
  - platform: mqtt
    topic: setMinutes
  action:
  - service: input_number.set_value
    data_template:
      entity_id: input_number.alarmminutes
      value: '{{ trigger.payload}}'
- id: Luminosite salon
  alias: Luminosite salon
  trigger:
  - platform: state
    entity_id: input_number.luminosite
  action:
  - service: light.turn_on
    data_template:
      entity_id: group.salonlight
      brightness: '{{ trigger.to_state.state | int }}'
- id: Rainbow light sur la lumiere du salon
  alias: Rainbow light sur la lumiere du salon
  trigger:
  - minutes: /3
    platform: time_pattern
    seconds: '0'
  condition:
  - condition: state
    entity_id: input_boolean.rainbow_light
    state: 'on'
  action:
  - data:
      brightness: 255
      effect: random
      transition: 10
    entity_id: group.salonlightcoul
    service: light.turn_on
- id: Rainbow light Stop sur la lumiere du salon
  alias: Rainbow light Stop sur la lumiere du salon
  trigger:
  - platform: state
    entity_id: input_boolean.rainbow_light
    to: 'off'
  action:
    service: scene.turn_on
    entity_id: scene.salon_normal
- id: Media player paused/stopped
  alias: Media player paused/stopped
  trigger:
  - platform: state
    entity_id: media_player.android_tv_shield
    to: paused
  condition:
  - condition: state
    entity_id: input_boolean.cast_light
    state: 'on'
  - condition: template
    value_template: '{{ states.media_player.android_tv_shield.attributes.app_name
      == "Plex" }}'
  action:
  - service: light.turn_on
    entity_id: group.salonlight
  - service: light.turn_on
    entity_id: light.bureau
- id: Media player paused/stopped
  alias: Media player paused/stopped
  trigger:
  - platform: state
    entity_id: media_player.android_tv_shield
    to: stopped
  condition:
  - condition: state
    entity_id: input_boolean.cast_light
    state: 'on'
  - condition: template
    value_template: '{{ states.media_player.android_tv_shield.attributes.app_name
      == "Plex" }}'
  action:
  - service: light.turn_on
    entity_id: group.salonlight
  - service: light.turn_on
    entity_id: light.bureau
- id: Media player playing
  alias: Media player playing
  trigger:
  - platform: state
    entity_id: media_player.android_tv_shield
    to: playing
  condition:
  - condition: state
    entity_id: input_boolean.cast_light
    state: 'on'
  - condition: template
    value_template: '{{ states.media_player.android_tv_shield.attributes.app_name
      == "Plex" }}'
  action:
  - service: light.turn_off
    entity_id: group.salonlight
  - service: light.turn_off
    entity_id: light.bureau
- id: Media player playing
  alias: Media player playing
  trigger:
  - platform: state
    entity_id: media_player.android_tv_shield
    to: resumed
  condition:
  - condition: state
    entity_id: input_boolean.cast_light
    state: 'on'
  - condition: template
    value_template: '{{ states.media_player.android_tv_shield.attributes.app_name
      == "Plex" }}'
  action:
  - service: light.turn_off
    entity_id: group.salonlight
  - service: light.turn_off
    entity_id: light.bureau
- id: Allume chambre le soir
  alias: Allume chambre le soir
  trigger:
  - entity_id: sensor.salon_motion
    from: '0'
    platform: state
    to: '1'
  condition:
  - condition: state
    entity_id: input_boolean.automa
    state: 'on'
  - condition: state
    entity_id: media_player.panasonic_viera_tv
    state: 'off'
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  - condition: state
    entity_id: input_boolean.bye
    state: 'on'
  - after: '22:30:00'
    before: 05:00:00
    condition: time
  - condition: state
    entity_id: input_boolean.stopsoir
    state: 'on'
  - condition: state
    entity_id: person.arnaud
    for:
      minutes: 5
    state: home
  action:
  - data_template:
      entity_id: media_player.entree
      volume_level: 0.3
    service: media_player.volume_set
  - data_template:
      cache: true
      message: Bonne nuit
    entity_id: media_player.entree
    service: tts.google_say
  - data:
      brightness: 155
    entity_id: light.chambrechevet
    service: light.turn_on
  - entity_id: scene.Eteint
    service: scene.turn_on
  - entity_id: light.bureau
    service: light.turn_off
  - entity_id: input_boolean.bye
    service: input_boolean.turn_off
- id: Mouvement salon absent
  alias: Mouvement salon absent
  initial_state: 'off'
  trigger:
  - platform: state
    entity_id: binary_sensor.entree_motion_active
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: device_tracker.mi9tpro_t_l_phonem
    state: not_home
  - condition: state
    entity_id: input_boolean.trackme_arno
    state: 'on'
  action:
  - service: notify.teleha
    data:
      title: detection intrus
      message: Intrusion dans la maison
- id: Mouvement escalier absent
  alias: Mouvement escalier absent
  initial_state: 'off'
  trigger:
  - platform: state
    entity_id: sensor.salon_motion
    from: '0'
    to: '1'
  condition:
  - condition: state
    entity_id: device_tracker.mi9tpro_t_l_phonem
    state: not_home
  - condition: state
    entity_id: input_boolean.trackme_arno
    state: 'on'
  action:
  - service: notify.teleha
    data:
      title: detection intrus
      message: Intrusion dans la maison
- id: Eteint WC
  alias: Eteint WC
  trigger:
  - platform: state
    entity_id: binary_sensor.pt2262_ecad69
    to: 'off'
    for: 00:04
  action:
  - data:
      entity_id: light.wc
      transition: 3
    service: light.turn_off
  mode: single
- id: Mouvement WC
  alias: Mouvement WC
  trigger:
  - entity_id: binary_sensor.pt2262_ecad69
    from: 'off'
    platform: state
    to: 'on'
  action:
  - data:
      brightness: 250
      transition: 2
    entity_id: light.wc
    service: light.turn_on
  mode: restart
- id: Positionne le flag pour l'annonce le matin
  alias: Positionne le flag pour l'annonce le matin
  trigger:
  - platform: time_pattern
    hours: '04'
    minutes: '0'
    seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.automa
    state: 'on'
  action:
    service: input_boolean.turn_on
    entity_id: input_boolean.bonjour
- id: Positionne le flag pour l'annonce le soir se coucher
  alias: Positionne le flag pour l'annonce le soir se coucher
  trigger:
  - platform: time_pattern
    hours: '04'
    minutes: '0'
    seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.automa
    state: 'on'
  action:
    service: input_boolean.turn_on
    entity_id: input_boolean.bye
- id: Allume Radiateur le matin
  alias: Allume Radiateur le matin
  trigger:
  - platform: time_pattern
    hours: '04'
    minutes: '0'
    seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.automa
    state: 'on'
  action:
    service: switch.turn_on
    entity_id: switch.chambre
- id: Eteint Radiateur dans la nuit
  alias: Eteint Radiateur dans la nuit
  trigger:
  - platform: time_pattern
    hours: '02'
    minutes: '0'
    seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.automa
    state: 'on'
  action:
    service: switch.turn_off
    entity_id: switch.chambre
- id: Eteint Radiateur le matin
  alias: Eteint Radiateur le matin
  trigger:
  - platform: time_pattern
    hours: '06'
    minutes: '0'
    seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.automa
    state: 'on'
  action:
    service: switch.turn_off
    entity_id: switch.chambre
- id: Allume les lumieres quand le soleil se couche Arnaud
  alias: Allume les lumieres quand le soleil se couche Arnaud
  trigger:
  - event: sunset
    offset: -00:15:00
    platform: sun
  condition:
  - condition: state
    entity_id: person.arnaud
    state: home
  action:
  - data:
      brightness: 255
      transition: 2700
    entity_id: group.salonlight
    service: light.turn_on
- id: Allume les lumieres quand le soleil se couche Arnaud decalage
  alias: Allume les lumieres quand le soleil se couche Arnaud decalage
  trigger:
  - event: sunset
    offset: -00:15:00
    platform: sun
  condition:
  - condition: state
    entity_id: person.arnaud
    state: home
  action:
  - data:
      brightness: 255
      transition: 1800
    entity_id: group.salonlight
    service: light.turn_on
- id: Allume tout en arrivant a la maison
  alias: Allume tout en arrivant a la maison
  trigger:
  - entity_id: person.arnaud
    from: not_home
    platform: state
    to: home
  condition:
  - condition: time
    after: '18:00'
    before: 08:30
  - condition: state
    entity_id: input_boolean.trackme_arno
    state: 'on'
  action:
  - entity_id: group.salonlight
    service: light.turn_on
  - entity_id: scene.Salon_normal
    service: scene.turn_on
  mode: single
- id: Eteint SDB la nuit
  alias: Eteint SDB la nuit
  trigger:
  - platform: state
    entity_id: binary_sensor.pt2262_9308f9
    to: 'off'
    for: 00:03
  condition:
  - condition: time
    after: '19:00'
    before: 04:59
  action:
  - service: light.turn_off
    data:
      entity_id: light.sdb
  mode: single
- id: Eteint SDB
  alias: Eteint SDB
  trigger:
  - platform: state
    entity_id: binary_sensor.pt2262_9308f9
    to: 'off'
    for: 00:07
  action:
  - data:
      entity_id: light.sdb
      transition: 3
    service: light.turn_off
  mode: single
- id: Eteint SDB quand on est en humidité normale
  alias: Eteint SDB quand on est en humidité normale
  trigger:
  - platform: numeric_state
    entity_id: sensor.alecto_ws1700_df_01_humidity
    below: '70'
  action:
  - service: light.turn_off
    data:
      entity_id: light.sdb
  mode: single
- id: Mouvement SDB
  alias: Mouvement SDB
  trigger:
  - entity_id: binary_sensor.pt2262_9308f9
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - after: 05:00
    before: '18:59'
    condition: time
  action:
  - data:
      brightness: 250
      transition: 2
    entity_id: light.sdb
    service: light.turn_on
  mode: restart
- id: Mouvement SDB night
  alias: Mouvement SDB night
  trigger:
  - entity_id: binary_sensor.pt2262_9308f9
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - after: '19:00'
    before: 04:59
    condition: time
  action:
  - data:
      brightness: 200
      transition: 2
    entity_id: light.sdb
    service: light.turn_on
  mode: restart
- id: Annonce voix
  alias: Annonce voix
  trigger:
  - platform: state
    entity_id: sensor.salon_motion
    from: '0'
    to: '1'
  condition:
  - condition: time
    after: 05:00
    before: '10:00'
  - condition: state
    entity_id: input_boolean.bonjour
    state: 'on'
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.entree
      volume_level: 0.3
  - service: tts.google_say
    entity_id: media_player.entree
    data_template:
      message: 'Arnaud, la météo prévoit, {{ states.sensor.meteotoday.state }} pour
        aujourd''hui. La température exterieure est de {{ states.sensor.tempext_temperature.state
        | round }} degrés. {%- if states.sensor.travail.state | int < 14 -%} il n''y
        a pas de monde sur la route {%- else -%} attention la route est chargée il
        vous faudra {{ states.sensor.google_travel_time__driving.state }} minutes
        pour aller au travail{%- endif %}, concernant les conditions de surf, {%-
        if (states.sensor.surf9h.state != "mauvais surf, session médiocre") and (states.sensor.surf13h.state
        != "mauvais surf, session médiocre") and (states.sensor.surf17h.state != "mauvais
        surf, session médiocre") -%} c''est bien toute la journée {%- endif %} {%-
        if (states.sensor.surf9h.state == "mauvais surf, session médiocre") and (states.sensor.surf13h.state
        == "mauvais surf, session médiocre") and (states.sensor.surf17h.state == "mauvais
        surf, session médiocre") -%} c''est pourri toute la journée {%- endif %} {%-
        if (states.sensor.surf9h.state != "mauvais surf, session médiocre") and (states.sensor.surf13h.state
        == "mauvais surf, session médiocre") and (states.sensor.surf17h.state == "mauvais
        surf, session médiocre") -%} c''est bien le matin tot {%- endif %} {%- if
        (states.sensor.surf9h.state != "mauvais surf, session médiocre") and (states.sensor.surf13h.state
        != "mauvais surf, session médiocre") and (states.sensor.surf17h.state == "mauvais
        surf, session médiocre") -%} c''est bien jusqu''en fin d''après midi {%- endif
        %} {%- if (states.sensor.surf9h.state != "mauvais surf, session médiocre")
        and (states.sensor.surf13h.state == "mauvais surf, session médiocre") and
        (states.sensor.surf17h.state != "mauvais surf, session médiocre") -%} c''est
        bien le matin et le soir {%- endif %} {%- if (states.sensor.surf9h.state ==
        "mauvais surf, session médiocre") and (states.sensor.surf13h.state != "mauvais
        surf, session médiocre") and (states.sensor.surf17h.state == "mauvais surf,
        session médiocre") -%} c''est bien l''après midi {%- endif %} #{%- if as_timestamp(states.calendar.dalliesagmailcom.attributes.start_time)
        - as_timestamp(now().strftime("%Y-%m-%d %H:%M:%S")) < 86400 -%} .  N''oubliez
        pas vous avez un rendez vous aujourd''hui.  {{ states.calendar.dalliesagmailcom.attributes.message
        }}.{%- endif %} #{%- if (states.calendar.contacts.state == ''on'') -%} N''oubliez
        pas vous avez un anniversaire a souhaiter, celui de {{ states.calendar.contacts.attributes.message
        }} {%- endif %}'
      cache: false
  - service: input_boolean.turn_off
    entity_id: input_boolean.bonjour
- id: Eteint tout en partant de la maison
  alias: Eteint tout en partant de la maison
  trigger:
  - entity_id: device_tracker.mi_9t_pro
    from: home
    platform: state
    to: not_home
  action:
  - entity_id: input_boolean.rainbow_light
    service: input_boolean.turn_off
  - entity_id: group.salonlight
    service: light.turn_off
  - entity_id: light.chambre
    service: light.turn_off
  - delay: 00:00:02
  - entity_id: group.salonlight
    service: light.turn_off
  - entity_id: light.chambre
    service: light.turn_off
- id: theme noir
  alias: theme noir
  trigger:
  - platform: state
    entity_id: input_select.themesi
    to: noir
  action:
  - service: frontend.set_theme
    data:
      name: noir
- id: theme jaune
  alias: theme jaune
  trigger:
  - platform: state
    entity_id: input_select.themesi
    to: jaune
  action:
  - service: frontend.set_theme
    data:
      name: jaune
- id: theme dark
  alias: theme dark
  trigger:
  - platform: state
    entity_id: input_select.themesi
    to: dark
  action:
  - service: frontend.set_theme
    data:
      name: dark
- id: theme white
  alias: theme white
  trigger:
  - platform: state
    entity_id: input_select.themesi
    to: white
  action:
  - service: frontend.set_theme
    data:
      name: white
- id: theme cyan
  alias: theme cyan
  trigger:
  - platform: state
    entity_id: input_select.themesi
    to: cyan
  action:
  - service: frontend.set_theme
    data:
      name: cyan
- id: theme bleu
  alias: theme bleu
  trigger:
  - platform: state
    entity_id: input_select.themesi
    to: bleu
  action:
  - service: frontend.set_theme
    data:
      name: bleu
- id: theme rouge
  alias: theme rouge
  trigger:
  - platform: state
    entity_id: input_select.themesi
    to: rouge
  action:
  - service: frontend.set_theme
    data:
      name: rouge
- id: theme vert
  alias: theme vert
  trigger:
  - platform: state
    entity_id: input_select.themesi
    to: vert
  action:
  - service: frontend.set_theme
    data:
      name: vert
- id: FreeBox Allume
  alias: FreeBox Allume
  trigger:
  - platform: state
    entity_id: input_select.freeplayon
    to: 'On'
  action:
    service: shell_command.allumefreebox
- id: FreeBox Eteinte
  alias: FreeBox Eteinte
  trigger:
  - platform: state
    entity_id: input_select.freeplayon
    to: 'Off'
  action:
    service: shell_command.eteintfreebox
- id: reveil matin Freebox
  alias: reveil matin Freebox
  trigger:
  - platform: time_pattern
    minutes: /5
    seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.automa
    state: 'on'
  - condition: state
    entity_id: input_boolean.alarmweekon
    state: 'on'
  - condition: state
    entity_id: input_boolean.alarmweekday
    state: 'on'
  - condition: state
    entity_id: input_boolean.freebox
    state: 'on'
  - condition: state
    entity_id: calendar.jours_feries_en_france
    state: 'off'
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: template
    value_template: '{{ now().strftime("%H:%M") == states.sensor.alarm_time.state
      }}'
  action:
    service: shell_command.allumefreebox
- id: reveil matin Aurore Semaine
  alias: reveil matin Aurore Semaine
  trigger:
  - minutes: /1
    platform: time_pattern
    seconds: '0'
  condition:
  - condition: state
    entity_id: input_boolean.automa
    state: 'on'
  - condition: state
    entity_id: input_boolean.alarmweekon
    state: 'on'
  - condition: state
    entity_id: input_boolean.alarmweekday
    state: 'on'
  - condition: state
    entity_id: calendar.jours_feries_en_france
    state: 'off'
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: template
    value_template: '{{ now().strftime("%H:%M") == states.sensor.alarm_time.state
      }}'
  action:
  - data:
      brightness: 50
      entity_id: light.chambrechevet
      transition: 300
    entity_id: light.chambrechevet
    service: light.turn_on
  mode: single
- id: reveil matin Aurore les weekend
  alias: reveil matin Aurore les weekend
  trigger:
  - platform: time_pattern
    minutes: /1
    seconds: '0'
  condition:
  - condition: state
    entity_id: input_boolean.automa
    state: 'on'
  - condition: state
    entity_id: input_boolean.alarmweekon
    state: 'on'
  - condition: state
    entity_id: input_boolean.alarmweekday
    state: 'off'
  - condition: time
    weekday:
    - sat
    - sun
  - condition: template
    value_template: '{{ now().strftime("%H:%M") == states.sensor.alarm_time.state
      }}'
  action:
  - service: light.turn_on
    entity_id: light.chambrechevet
    data:
      transition: 600
      brightness: 255
      entity_id: light.chambrechevet
  mode: single
- id: Alarm Away when Leave home
  alias: Alarm Away when Leave home
  trigger:
  - entity_id: person.arnaud
    from: home
    platform: state
    to: not_home
  condition:
  - condition: state
    entity_id: input_boolean.trackme_arno
    state: 'on'
  action:
  - data:
      code: '0007'
    entity_id: alarm_control_panel.ha_alarm
    service: alarm_control_panel.alarm_arm_away
- id: Alarm Auto DISARM when Enter home
  alias: Alarm Auto DISARM when Enter home
  trigger:
  - entity_id: person.arnaud
    from: not_home
    platform: state
    to: home
  condition:
  - condition: state
    entity_id: input_boolean.trackme_arno
    state: 'on'
  action:
  - data:
      code: '0007'
    entity_id: alarm_control_panel.ha_alarm
    service: alarm_control_panel.alarm_disarm
- id: Print 3D fini sur la CR10
  alias: Print 3D fini sur la CR10
  trigger:
  - platform: numeric_state
    entity_id: sensor.creality_cr10_job_percentage
    above: 96
  action:
  - service: notify.teleha
    data:
      message: Print presque fini !!!
- id: Print 3D fini sur la Anet A8
  alias: Print 3D fini sur la Anet A8
  trigger:
  - platform: numeric_state
    entity_id: sensor.anet_a8_job_percentage
    above: 96
  action:
  - service: notify.teleha
    data:
      message: Print presque fini !!!
- id: Print 3D fini stop Creality CR10
  alias: Print 3D fini stop Creality CR10
  trigger:
  - platform: state
    entity_id: sensor.creality_cr10_current_state
    from: Printing
    to: Operational
  condition:
  - condition: state
    entity_id: input_boolean.autoprint
    state: 'on'
  action:
  - delay: 00:05:00
  - service: switch.turn_off
    entity_id: switch.creality_cr10
- id: Print 3D fini stop Creality Anet A8
  alias: Print 3D fini stop Creality Anet A8
  trigger:
  - platform: state
    entity_id: sensor.anet_a8_current_state
    from: Printing
    to: Operational
  condition:
  - condition: state
    entity_id: input_boolean.autoprint2
    state: 'on'
  action:
  - delay: 00:05:00
  - service: switch.turn_off
    entity_id: switch.broadlink_s4
  mode: single
- id: Print 3D pas fini la nuit stop auto CR10
  alias: Print 3D pas fini la nuit stop auto CR10
  trigger:
  - platform: state
    entity_id: input_boolean.bye
    from: 'on'
    to: 'off'
  condition:
  - condition: state
    entity_id: sensor.creality_cr10_current_state
    state: Printing
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.autoprint
- id: Print 3D pas fini la nuit stop auto Anet A8
  alias: Print 3D pas fini la nuit stop auto Anet A8
  trigger:
  - platform: state
    entity_id: input_boolean.bye
    from: 'on'
    to: 'off'
  condition:
  - condition: state
    entity_id: sensor.anet_a8_current_state
    state: Printing
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.autoprint2
- id: Passe l'aspirateur la journée
  alias: Passe l'aspirateur la journée
  trigger:
  - platform: time_pattern
    minutes: /1
    seconds: 0
  condition:
  - condition: template
    value_template: '{{ ((now().strftime("%s") | int ) | timestamp_custom("%H:%M")
      == states.sensor.vacuumalarm_time.state) }}'
  - condition: state
    entity_id: input_boolean.vacuumauto
    state: 'on'
  action:
    service: script.turn_on
    entity_id: script.vacuumon
- id: '1575718982718'
  alias: allumechevet
  description: ''
  trigger:
  - entity_id: sensor.salon_motion
    from: '0'
    platform: state
    to: '1'
  condition:
  - condition: state
    entity_id: person.arnaud
    state: home
  - after: '22:30'
    before: 04:00
    condition: time
  - condition: state
    entity_id: media_player.panasonic_viera_tv
    state: 'off'
  action:
  - data: {}
    entity_id: light.chambrechevet
    service: light.turn_on
  - data: {}
    entity_id: light.lumieres_du_salon
    service: light.turn_off
- id: '1582997995534'
  alias: Alarme status sensor
  description: Alarme status sensor
  trigger:
  - entity_id: alarm_control_panel.ha_alarm
    platform: state
    to: armed_away
  condition: []
  action:
  - data:
      xy_color:
      - 0.95
      - 0.05
    entity_id: light.salon_status_alarme
    service: light.turn_on
  - data:
      xy_color:
      - 0.95
      - 0.05
    entity_id: light.couloir_status_alarme_2
    service: light.turn_on
- id: '1582999038207'
  alias: alarme sensor home
  description: alarme sensor home
  trigger:
  - entity_id: alarm_control_panel.ha_alarm
    platform: state
    to: disarmed
  condition: []
  action:
  - entity_id: light.salon_status_alarme
    service: light.turn_off
  - entity_id: light.couloir_status_alarme_2
    service: light.turn_off
- id: '1583098452750'
  alias: alarm led night
  description: Alarme led night
  trigger:
  - entity_id: alarm_control_panel.ha_alarm
    platform: state
    to: armed_night
  condition: []
  action:
  - data:
      xy_color:
      - 0.05
      - 0.1
    entity_id: light.salon_status_alarme
    service: light.turn_on
  - data:
      xy_color:
      - 0.05
      - 0.01
    entity_id: light.couloir_status_alarme
    service: light.turn_on
- id: '1585155954250'
  alias: CubeMotionLightOff
  description: CubeMotionLightOff
  trigger:
  - entity_id: sensor.move
    platform: state
    to: Eteint
  condition: []
  action:
  - scene: scene.eteint
- id: '1585242287474'
  alias: CubeMotionLightOn
  description: ''
  trigger:
  - entity_id: sensor.move
    platform: state
    to: Allume
  condition: []
  action:
  - scene: scene.allume
- id: '1585242437775'
  alias: CubeMotionLightCinema
  description: CubeMotionLightCinema
  trigger:
  - entity_id: sensor.move
    platform: state
    to: Cinema
  condition: []
  action:
  - data: {}
    entity_id: input_boolean.cast_light
    service: input_boolean.turn_on
- id: '1585242563432'
  alias: CubeMotionLightCinemaOff
  description: CubeMotionLightCinemaOff
  trigger:
  - entity_id: sensor.move
    from: Cinema
    platform: state
  condition: []
  action:
  - data: {}
    entity_id: input_boolean.cast_light
    service: input_boolean.turn_off
- id: '1585242744900'
  alias: CubeMotionLightSoireeOn
  description: CubeMotionLightSoireeOn
  trigger:
  - entity_id: sensor.move
    platform: state
    to: Soiree
  condition: []
  action:
  - data: {}
    entity_id: input_boolean.rainbow_light
    service: input_boolean.turn_on
- id: '1585242852448'
  alias: CubeMotionLightSoireeOff
  description: CubeMotionLightSoireeOff
  trigger:
  - entity_id: sensor.move
    from: Soiree
    platform: state
  condition: []
  action:
  - data: {}
    entity_id: input_boolean.rainbow_light
    service: input_boolean.turn_off
- id: Servo Up
  alias: Write Servo Value to ESP
  trigger:
  - entity_id: input_number.servo_control
    platform: state
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: esphome.autocamjardin_control_servo
    data:
      level: '{{ trigger.to_state.state | int }}'
  mode: single
- id: '1596022266399'
  alias: ambilight coupe ledtv
  description: ambilight coupe ledtv
  trigger:
  - entity_id: light.wled_3
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - service: media_player.turn_off
    target:
      entity_id: media_player.panasonic_viera_tv
  mode: single
- id: '1597299643327'
  alias: tvoff amibilight off
  description: tvoff amibilight off
  trigger:
  - entity_id: media_player.panasonic_viera_tv
    from: 'on'
    platform: state
  condition: []
  action:
  - data: {}
    service: light.turn_off
    target:
      entity_id: light.wled_3
  mode: single
- id: '1608064898667'
  alias: wled non dispo
  description: ''
  use_blueprint:
    path: ini/simple-mobile-notification-when-device-becomes-unavailable.yaml
    input:
      notify_device: c9310c8d01704af0bd00b3356557492c
      entity_name: light.wled
- id: '1608202114202'
  alias: tvon amibilight on
  description: tvon amibilight on
  trigger:
  - entity_id: media_player.panasonic_viera_tv
    platform: state
    to: 'on'
  condition: []
  action:
  - data: {}
    service: light.turn_on
    target:
      entity_id: light.wled_3
  mode: single
- id: '1608731955405'
  alias: La balise maison est analysée
  description: Lance Spotify sur Freebox player
  trigger:
  - platform: tag
    tag_id: d4461284-19d1-4a84-9e57-79b18feccbb0
  condition: []
  action:
  - service: light.turn_off
    entity_id: light.lumieres_du_salon
  - service: light.turn_on
    data: {}
    entity_id: light.chambrechevet
  mode: single
- id: '1608735066027'
  alias: 'La balise rap us est analysée '
  description: Lance Spotify sur Freebox player
  trigger:
  - platform: tag
    tag_id: 88d97a12-36a2-4c18-bc01-7fd45a45b46f
  condition: []
  action:
  - service: media_player.select_source
    entity_id: media_player.spotify_arnaud
    data:
      source: Freebox Player
  - service: media_player.shuffle_set
    data:
      shuffle: true
    entity_id: media_player.spotify_arnaud
  - service: media_player.play_media
    data:
      media_content_id: spotify:playlist:6wN6qRLetX7NIxVXUuRd3H?si=c1TTDYWgTSGCHgFo7anIJA
      media_content_type: playlist
    entity_id: media_player.spotify_arnaud
  mode: single
- id: '1608735883777'
  alias: 'La balise ganorap est analysée '
  description: Lance Spotify sur Freebox player
  trigger:
  - platform: tag
    tag_id: 7dc7afba-d40e-4047-b81b-9980b25e5c74
  condition: []
  action:
  - service: media_player.select_source
    entity_id: media_player.spotify_arnaud
    data:
      source: Freebox Player
  - service: media_player.shuffle_set
    data:
      shuffle: true
    entity_id: media_player.spotify_arnaud
  - service: media_player.play_media
    data:
      media_content_id: spotify:playlist:3YoPsHHEwIRvjqEpoRJp2r?si=sC7gLdUbT_-2jt93hfQyeA
      media_content_type: playlist
    entity_id: media_player.spotify_arnaud
  mode: single
- id: '1609672455080'
  alias: Theme switcher
  description: on switch selon l'heure de la journée
  use_blueprint:
    path: KTibow/light-dark-theme-switcher-based-on-sun.yaml
    input:
      light_theme: ios-light-mode
      dark_theme: slate
- id: '1609696836642'
  alias: Themes sun
  description: ''
  trigger:
  - platform: state
    entity_id: sun.sun
    to: above_horizon
  condition: []
  action:
  - service: frontend.set_theme
    data:
      name: ios-light-mode
  mode: single
- id: '1609696872663'
  alias: Themes sun Dark
  description: ''
  trigger:
  - platform: state
    entity_id: sun.sun
    to: below_horizon
  condition: []
  action:
  - service: frontend.set_theme
    data:
      name: slate
  mode: single
- id: '1610636564864'
  alias: Alarme Video
  description: alarme video
  trigger:
  - platform: state
    entity_id: sensor.salon_motion
    to: '1'
  - platform: state
    entity_id: sensor.salon_motion
    to: '2'
  condition:
  - condition: state
    entity_id: person.arnaud
    state: not_home
  action:
  - service: camera.snapshot
    data:
      filename: /config/www/surf/videos/Alarme/Hall_{{ now().strftime("%Y%m%d-%H%M%S")
        }}.jpg
    entity_id: camera.cr10_cam_esp
  - service: notify.teleha
    data:
      message: Intrus detecté
      data:
        photo:
        - file: /config/www/surf/videos/Alarme/Hall_{{ now().strftime("%Y%m%d-%H%M%S")
            }}.jpg
          caption: Photo intrus
  mode: single
- id: '1610882853050'
  alias: Allume cuisine jour
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.couloir_motion
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    data: {}
    entity_id: light.chambre_2
  mode: single
- id: '1610882962514'
  alias: Mouvement Cuisine
  description: ''
  trigger:
  - entity_id: binary_sensor.couloir_motion
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    data:
      entity_id: light.cuisine
      brightness: 250
  mode: restart
- id: '1610883093468'
  alias: Eteint Cuisine
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.couloir_motion
    to: 'off'
    for: 00:01
  condition: []
  action:
  - data:
      entity_id: light.cuisine
    service: light.turn_off
  mode: single
- id: '1611322002967'
  alias: Alarme Video fichier video
  description: alarme video fichier video
  trigger:
  - platform: state
    entity_id: sensor.salon_motion
    to: '1'
  - platform: state
    entity_id: sensor.salon_motion
    to: '2'
  condition:
  - condition: state
    entity_id: person.arnaud
    state: not_home
  action:
  - service: shell_command.videocam
    entity_id: camera.cr10_cam_esp
    data: {}
  - delay: 00:01:00
  mode: single
- id: '1613026816242'
  alias: deepstack telegram
  description: ''
  trigger:
  - platform: event
    event_type: deepstack.object_detected
    event_data:
      name: person
  condition: []
  action:
  - service: telegram_bot.send_photo
    data:
      caption: New person detection with confidence {{ trigger.event.data.confidence
        }}
      file: '{{ trigger.event.data.saved_file  }}'
  mode: single
- id: '1613027170365'
  alias: scan deepstack
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.couloir_motion
    to: 'on'
  condition:
  - condition: state
    entity_id: person.arnaud
    state: not_home
  action:
  - service: image_processing.scan
    data: {}
    entity_id: image_processing.deepstack_person_detector
  mode: single
- id: '1613035774394'
  alias: Allume Couloir et Hall
  description: Allume Couloir et Hall mvt ESP
  trigger:
  - platform: state
    entity_id: binary_sensor.salon_motion
    to: 'on'
  condition:
  - condition: time
    after: 07:00
    before: '19:00'
  action:
  - service: light.turn_on
    data:
      brightness: 250
    entity_id: light.hall
  - service: light.turn_on
    data:
      brightness: 250
    entity_id: light.escalier
  mode: single
- id: '1613035895897'
  alias: Eteint Hall Escalier
  description: Eteint Hall Escalier
  trigger:
  - platform: state
    entity_id: binary_sensor.salon_motion
    to: 'off'
    for: 00:01
  condition: []
  action:
  - data:
      entity_id: light.hall
    service: light.turn_off
  - service: light.turn_off
    data:
      entity_id: light.escalier
  mode: single
- id: '1613375781958'
  alias: scan deepstack Jardin
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.salon_motion
    to: 'on'
  condition: []
  action:
  - service: image_processing.scan
    data: {}
    entity_id: image_processing.deepstack_person_detector
  mode: single
- id: '1613572788943'
  alias: Write Servo Value to ESP Pan
  description: ''
  trigger:
  - entity_id: input_number.servo_control2
    platform: state
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: esphome.servo_control_servo2
    data:
      level: '{{ trigger.to_state.state | int }}'
  mode: single
- id: '1613829385662'
  alias: Allume Couloir et Hall absent
  description: Allume Couloir et Hall mvt ESP
  trigger:
  - platform: state
    entity_id: binary_sensor.salon_motion
    to: 'on'
  condition:
  - condition: state
    entity_id: person.arnaud
    state: not_home
  action:
  - service: light.turn_on
    data:
      brightness: 250
    entity_id: light.hall
  - service: light.turn_on
    data:
      brightness: 250
    entity_id: light.escalier
  mode: single
- id: '1613829588898'
  alias: Allume Couloir et Hall nuit
  description: Allume Couloir et Hall mvt ESP
  trigger:
  - platform: state
    entity_id: binary_sensor.salon_motion
    to: 'on'
  condition:
  - condition: time
    after: '19:00'
    before: 07:00
  action:
  - service: light.turn_on
    data:
      brightness: 110
    entity_id: light.hall
  - service: light.turn_on
    data:
      brightness: 110
    entity_id: light.escalier
  mode: single
- id: '1613943840576'
  alias: wled chambre 3d
  description: ''
  trigger:
  - platform: state
    entity_id: switch.broadlink_s4
    to: 'on'
  - platform: state
    entity_id: switch.broadlink_s3
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    data: {}
    entity_id: light.wled_2
  mode: single
- id: '1614328270681'
  alias: Eteint WC (Dupliquer)
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.pt2262_ecad69
    to: 'off'
    for: 00:06
  condition: []
  action:
  - data:
      entity_id: light.wc
    service: light.turn_off
  mode: single
- id: '1614328307114'
  alias: Eteint SDB (Dupliquer)
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.pt2262_9308f9
    to: 'off'
    for: 00:10
  condition: []
  action:
  - data:
      entity_id: light.sdb
    service: light.turn_off
  mode: single
- id: '1615538506175'
  alias: Timelapse
  description: alarme video
  trigger:
  - platform: time
    at: '14:00'
  condition: []
  action:
  - service: camera.snapshot
    data:
      filename: /config/www/surf/videos/Alarme/TimeLapse_{{ now().strftime("%Y%m%d-%H%M%S")
        }}.jpg
    entity_id: camera.creality
  mode: single
- id: '1627974999432'
  alias: Freeplayer coupe ledtv
  description: Freeplayer coupe ledtv
  trigger:
  - entity_id: sensor.freeplayer
    from: '1'
    platform: state
  condition: []
  action:
  - service: media_player.turn_off
    target:
      entity_id: media_player.panasonic_viera_tv
  mode: single
